---
title: "Selection Bias & Missing Data Challenge - Part 2"
subtitle: "Creating a Statistics Meme: Visualizing Selection Bias"
format:
  html: default
execute:
  echo: true
  eval: true
---

```{r setup, include=FALSE}
# Setup chunk: Suppress warnings and messages for cleaner output
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE
)
```

# üé® Selection Bias & Missing Data Challenge - Part 2

::: {.callout-important}
## üìä Challenge Requirements

**Your Task:** Create a four-panel statistics meme demonstrating selection bias using your original image and stippled version from [Part 1](https://flyaflya.github.io/stippleChallenge/).

**Prerequisites:** Completed [Part 1](https://flyaflya.github.io/stippleChallenge/) with:

1. Your original image file
2. Your stippled image (numpy array or R matrix)
3. Image dimensions (height and width)

**Deliverables:**

1. Four-panel meme (1√ó4 or 2√ó2 layout) with labels: Reality, Your Model, Selection Bias, Estimate
2. Code (Python or R) that generates the meme
3. GitHub Pages site named "statsMemeChallenge" with your meme and explanation

**Repository Information:**

- **Source/Starter File:** Available in the main repository at [https://github.com/flyaflya/statsMemeChallenge](https://github.com/flyaflya/statsMemeChallenge)
- **Challenge Read Online:** View the challenge instructions at [https://flyaflya.github.io/statsMemeChallenge](https://flyaflya.github.io/statsMemeChallenge)
- **Your Submission:** Fork this challenge and create your GitHub Pages site at `https://[your-username].github.io/statsMemeChallenge/`
:::

## The Problem: Visualizing Selection Bias

Selection bias occurs when observed data isn't representative of the population. Your meme will show:

- **Reality**: Your original image (truth)
- **Your Model**: Your stippled image (representation)
- **Selection Bias**: A bold letter "S" (systematic missing data pattern)
- **Estimate**: Stippled image with "S" mask applied (biased estimate)

**Key Concept:** Images are simply matrices‚Äî2D arrays where each value represents a pixel (0.0 = black, 1.0 = white). Your stippled image is a matrix with black dots (data points) on a white background. Selection bias removes some of these pixels (data points) in a systematic pattern (the "S"), creating a biased estimate. You'll use image composition tools (matplotlib in Python, imager in R) to arrange these matrices into a memorable visualization.

## Exemplar

![Exemplar statistics meme showing the four-panel structure: Reality (original image), Your Model (stippled version), Selection Bias (letter S), and Estimate (masked stippled image)](statistics_meme.png)

**Your Goal:** Recreate this structure using **your own** original and stippled images from [Part 1](https://flyaflya.github.io/stippleChallenge/).

## Why This Matters

This exercise is fundamentally about **walking AI through a process** to create valuable output. You're not just coding‚Äîyou're collaborating with AI to transform abstract statistical concepts into a memorable visual artifact. The meme you create will serve as a mental anchor: whenever you think about selection bias in the future, you'll ask yourself: **"Does my sample match my population of interest?"** This visualization will stick with you for the rest of your life, making it easier to recognize and address selection bias in real-world data analysis.

## Getting Started: Repository Setup üöÄ

::: {.callout-important}
## üìÅ Repository Setup Instructions

**Step 1:** Fork the starter repository:

- Navigate to [https://github.com/flyaflya/statsMemeChallenge](https://github.com/flyaflya/statsMemeChallenge)
- Fork the repository to your GitHub account (this creates `https://github.com/[your-username]/statsMemeChallenge`)

**Step 2:** Clone your forked repository locally using Cursor (or VS Code)

**Step 3:** Set up GitHub Pages:

- Go to your repository settings (click the "Settings" tab in your GitHub repository)
- Scroll down to the "Pages" section in the left sidebar
- Under "Source", select "Deploy from a branch"
- Choose "main" branch and "/ (root)" folder
- Click "Save"
- Your site will be available at: `https://[your-username].github.io/statsMemeChallenge/`
- **Note:** It may take a few minutes for the site to become available after enabling Pages

**Step 4:** You're ready to start! Use the `index.qmd` file as your starting point.
:::

## Implementation Guide

::: {.callout-important}
## üìù Code Visibility in Final HTML

**Important:** When you create your final `index.qmd` file, use `echo: false` for all code chunks that generate the meme. The rendered HTML should show only the meme image and your explanation, not the code. The code should still be in the `.qmd` file (so it can be rendered), but it won't be displayed in the HTML output.
:::

### Step 1: Load Your Images

::: {.panel-tabset}

### R

```{r}
#| label: load-images-r
#| echo: true
#| eval: true

library(imager)

# Load original image
original_img <- load.image('thumbsup.png')
if(dim(original_img)[3] == 3) {
  original_img <- grayscale(original_img)
}
# Convert to matrix [h, w] and normalize
# imager stores as [x, y] so we transpose to get [h, w]
arr <- as.array(original_img)
original_array <- t(arr[,,1,1]) / max(arr)

# Get dimensions
h <- nrow(original_array)
w <- ncol(original_array)

# Load stippled image (from Part 1 - see https://flyaflya.github.io/stippleChallenge/)
# Try to load from saved file first
if(file.exists('stippleImage.rds')) {
  stipple_array <- readRDS('stippleImage.rds')
  cat("Loaded stippled image from stippleImage.rds\n")
} else if(file.exists('../stippleChallenge/stippleImage.rds')) {
  stipple_array <- readRDS('../stippleChallenge/stippleImage.rds')
  cat("Loaded stippled image from stippleChallenge directory\n")
} else {
  # If no saved file, you need to regenerate it using the stippling algorithm from Part 1
  # For now, create a simple test pattern so you can see the structure
  # REPLACE THIS with your actual stippled image generation code from Part 1
  cat("WARNING: No stippled image found. Using placeholder.\n")
  cat("You need to either:\n")
  cat("  1. Save your stippled image as 'stippleImage.rds' using: saveRDS(stipple_pattern, 'stippleImage.rds')\n")
  cat("  2. Or regenerate it here using the stippling algorithm from Part 1\n")
  stipple_array <- matrix(1.0, nrow = h, ncol = w)  # Placeholder - all white
}

# Check and fix dimensions if needed
if(!identical(dim(stipple_array), dim(original_array))) {
  cat("WARNING: Stipple dimensions", dim(stipple_array), "don't match original", dim(original_array), "\n")
  cat("Resizing stipple to match original dimensions...\n")
  # If dimensions don't match, we need to resize or regenerate
  # For now, create a new matrix with correct dimensions
  if(nrow(stipple_array) != h || ncol(stipple_array) != w) {
    stipple_array <- matrix(1.0, nrow = h, ncol = w)
    cat("Created placeholder stipple with correct dimensions. You need to regenerate with correct size.\n")
  }
}

cat("Original dimensions:", dim(original_array), "\n")
cat("Stipple dimensions:", dim(stipple_array), "\n")
cat("Stipple value range:", range(stipple_array), "\n")
```

:::

### Step 2: Create the Block Letter "S"

Create a matrix matching your image dimensions with a bold letter "S" rendered as black pixels on a white background.

**Hints:**

- Use image drawing libraries to render text (PIL/Pillow in Python, `magick` in R)
- Create a white background matrix matching your image dimensions (height √ó width)
- Render a bold letter "S" centered in the image (try 80-90% of image height for font size)
- Convert the result to a matrix with values in [0, 1] range (0.0 = black, 1.0 = white)
- The "S" should be clearly visible and fill most of the image space

::: {.panel-tabset}

### R

```{r}
#| label: create-s-letter-r
#| echo: true
#| eval: true

library(magick)

# Create a white background image matching original dimensions
s_img <- image_blank(width = w, height = h, color = "white")

# Calculate font size (80-90% of image height)
font_size <- as.integer(h * 0.85)

# Create the "S" text with bold font
s_text <- image_annotate(
  s_img,
  text = "S",
  size = font_size,
  gravity = "center",
  font = "Arial-Bold",
  color = "black",
  weight = 700
)

# Save temporarily and load with imager for reliable conversion
temp_file <- tempfile(fileext = ".png")
image_write(s_text, temp_file)

# Load with imager
s_cimg_temp <- load.image(temp_file)
if(dim(s_cimg_temp)[3] == 3) {
  s_cimg_temp <- grayscale(s_cimg_temp)
}

# Convert to matrix [h, w] format
s_arr <- as.array(s_cimg_temp)
s_matrix <- t(s_arr[,,1,1]) / max(s_arr)

# Clean up temp file
unlink(temp_file)

cat("S matrix dimensions:", dim(s_matrix), "\n")
cat("S matrix range:", range(s_matrix), "\n")
```

:::

### Step 3: Create the Masked Estimate

Your stippled image is a matrix where black dots (0.0) represent data points and white (1.0) is background. The "S" matrix shows where selection bias occurs (black "S" = missing data). To create the masked estimate, remove stipple points (set to white) wherever the "S" is black.

**Hints:**

- Create a binary mask by thresholding the "S" image (e.g., pixels < 0.5 are part of the "S")
- Apply the mask to your stippled image: where the "S" is black, set those pixels to white (1.0)
- Where the "S" is white, keep the original stipple values
- This creates the visual effect of "missing data" in the shape of the "S"
- Use conditional assignment or boolean masking (e.g., `np.where()` in Python, `ifelse()` in R)

::: {.panel-tabset}

### R

```{r}
#| label: create-masked-estimate-r
#| echo: true
#| eval: true

# Create binary mask: pixels < threshold are part of the "S" (black = missing data)
threshold <- 0.5
s_mask <- s_matrix < threshold

# Apply mask to stippled image
# Where "S" is black (s_mask == TRUE), set pixels to white (1.0) - removing stipples
# Where "S" is white (s_mask == FALSE), keep original stipple values
masked_estimate <- ifelse(s_mask, 1.0, stipple_array)

# Ensure dimensions match
cat("Masked estimate dimensions:", dim(masked_estimate), "\n")
cat("Masked estimate range:", range(masked_estimate), "\n")
```

:::

### Step 4: Assemble the Four-Panel Meme

Use the image composition capabilities of matplotlib (Python) or imager (R) to arrange your four matrices as panels in a single figure.

**Hints:**

- Create a multi-panel layout (1√ó4 for horizontal, 2√ó2 for grid)
- Display each matrix as a grayscale image: original, stippled, "S", and masked stippled
- Add clear labels: "Reality", "Your Model", "Selection Bias", "Estimate"
- Use minimal spacing between panels for a clean, professional look
- Consider a light background color (like pink) to make panels stand out
- Save with high DPI (150-300) for quality output
- In Python: use `plt.subplots()` and `imshow()` for each panel
- In R: use `par(mfrow = ...)` and `plot()` with imager's `as.cimg()` to convert matrices

::: {.panel-tabset}

### R

```{r}
#| label: assemble-meme-r
#| echo: true
#| eval: true
#| fig-width: 16
#| fig-height: 4
#| dpi: 300

# Convert matrices to imager format
# All matrices are in [h, w] format, need to transpose to [w, h] for imager
# as.cimg needs: t(matrix), x = width (ncol), y = height (nrow), cc = 1 (grayscale)
original_cimg <- as.cimg(t(original_array), x = w, y = h, cc = 1)
stipple_cimg <- as.cimg(t(stipple_array), x = w, y = h, cc = 1)
s_cimg <- as.cimg(t(s_matrix), x = w, y = h, cc = 1)
masked_cimg <- as.cimg(t(masked_estimate), x = w, y = h, cc = 1)

# Create 1√ó4 layout (horizontal)
par(mfrow = c(1, 4), mar = c(2, 2, 3, 2), bg = "pink")

# Panel 1: Reality (original image)
plot(original_cimg, axes = FALSE, main = "Reality", cex.main = 1.5)

# Panel 2: Your Model (stippled image)
plot(stipple_cimg, axes = FALSE, main = "Your Model", cex.main = 1.5)

# Panel 3: Selection Bias (S letter)
plot(s_cimg, axes = FALSE, main = "Selection Bias", cex.main = 1.5)

# Panel 4: Estimate (masked stippled image)
plot(masked_cimg, axes = FALSE, main = "Estimate", cex.main = 1.5)
```

:::

## Final Meme Generation

The code below generates the final four-panel meme. In the rendered HTML, this code will be hidden (`echo: false`) so only the meme and explanation are visible.

```{r}
#| label: final-meme-generation
#| echo: false
#| eval: true
#| fig-width: 16
#| fig-height: 4
#| dpi: 300
#| fig-cap: "Four-panel statistics meme demonstrating selection bias: Reality (original image), Your Model (stippled version), Selection Bias (letter S), and Estimate (masked stippled image showing biased result)"

# Convert matrices to imager format
# All matrices are in [h, w] format, need to transpose to [w, h] for imager
# as.cimg needs: t(matrix), x = width (ncol), y = height (nrow), cc = 1 (grayscale)
original_cimg <- as.cimg(t(original_array), x = w, y = h, cc = 1)
stipple_cimg <- as.cimg(t(stipple_array), x = w, y = h, cc = 1)
s_cimg <- as.cimg(t(s_matrix), x = w, y = h, cc = 1)
masked_cimg <- as.cimg(t(masked_estimate), x = w, y = h, cc = 1)

# Create 1√ó4 layout (horizontal)
par(mfrow = c(1, 4), mar = c(2, 2, 3, 2), bg = "pink")

# Panel 1: Reality (original image)
plot(original_cimg, axes = FALSE, main = "Reality", cex.main = 1.5)

# Panel 2: Your Model (stippled image)
plot(stipple_cimg, axes = FALSE, main = "Your Model", cex.main = 1.5)

# Panel 3: Selection Bias (S letter)
plot(s_cimg, axes = FALSE, main = "Selection Bias", cex.main = 1.5)

# Panel 4: Estimate (masked stippled image)
plot(masked_cimg, axes = FALSE, main = "Estimate", cex.main = 1.5)
```

## Understanding Selection Bias Through This Meme

This visualization demonstrates **selection bias**‚Äîa fundamental problem in statistics where the data we observe is not representative of the population we want to study.

**The Four Panels Explained:**

1. **Reality**: The original image represents the true population‚Äîthe complete, unbiased truth we want to understand.

2. **Your Model**: The stippled version represents your statistical model‚Äîa simplified representation of reality using data points (the black dots). This is your best attempt to capture the truth.

3. **Selection Bias**: The bold letter "S" represents a systematic pattern of missing data. In real-world scenarios, selection bias occurs when certain groups or regions are systematically excluded from your sample (e.g., only surveying people who respond to emails, only studying accessible locations, etc.).

4. **Estimate**: The masked stippled image shows what happens when selection bias is applied to your model. Notice how the "S" shape creates a gap in your data‚Äîthe stipples (data points) are missing in that region. This biased estimate no longer accurately represents reality because important information has been systematically excluded.

**Key Takeaway:** Selection bias occurs when your sample doesn't match your population of interest. The "S" in this meme serves as a visual reminder: whenever you analyze data, ask yourself: **"Does my sample match my population of interest?"** If the answer is no, your estimates will be biased, just like the masked estimate panel shows.

This visualization will stick with you because it transforms an abstract statistical concept into a concrete, memorable image. The next time you encounter selection bias in real data analysis, you'll remember this meme and be better equipped to recognize and address the problem.

## Tips for Success

1. **Font Selection**: Use bold fonts (Arial Bold, DejaVu Sans Bold) for the "S"
2. **Threshold Tuning**: Adjust `threshold` (typically 0.5) for clean mask edges
3. **Spacing**: Minimize gaps between panels (`wspace=0`, `hspace=0`)
4. **Background**: Light pink background helps panels stand out
5. **Save Quality**: Use DPI 150-300 for crisp output
6. **Layout Choice**: 1√ó4 for wide images, 2√ó2 for square/tall images

## Submission Requirements

**Important:** Your final GitHub Pages site should be a clean, professional presentation that focuses on the meme and explanation, not the code.

**Repository Contents:**

- [ ] `index.qmd` file with your code to generate the meme
- [ ] Any supporting code files (Python `.py` files or R scripts) that your `index.qmd` references
- [ ] Your original image and stippled image files (or `.npy`/`.rds` files) needed to generate the meme
- [ ] Rendered HTML output (generated by rendering the `index.qmd` file)

**HTML Output Requirements:**

- [ ] **Code should NOT be visible** in the rendered HTML (use `echo: false` for code chunks that generate the meme)
- [ ] The HTML should display **only the four-panel meme image**
- [ ] Include a **brief explanation** of selection bias and how your meme demonstrates it
- [ ] Professional, clean presentation suitable for sharing

**Submission Checklist:**

- [ ] All four panels: Reality, Your Model, Selection Bias, Estimate
- [ ] Clear labels on each panel
- [ ] Bold, properly-sized "S" letter
- [ ] Masked estimate correctly removes stipples within "S"
- [ ] Clean layout with minimal spacing
- [ ] Code runs without errors and generates the meme
- [ ] `index.qmd` file in repository with `echo: false` for meme generation code
- [ ] Supporting code files (if any) included in repository
- [ ] Document rendered to HTML successfully (meme generated, code hidden)
- [ ] HTML files uploaded to your repository
- [ ] GitHub Pages enabled and working
- [ ] Site accessible at `https://[your-username].github.io/statsMemeChallenge/`
- [ ] Final site shows only the meme and explanation (no visible code)
- [ ] Brief explanation of selection bias included in HTML

**Remember:** Create a memorable, educational visualization that helps others understand selection bias. This is about more than completing an assignment‚Äîit's about building a lasting understanding through creative collaboration with AI.
